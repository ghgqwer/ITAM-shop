<script>import { onMount, onDestroy, setContext, getContext } from "svelte";
import { Map, LayerGroup } from "leaflet";
import { setControlLayer } from "./utils/index";
export let options = {};
export let name = "";
export let checked = false;
export let instance = void 0;
export let layerType = void 0;
let parentContext = getContext(Map);
const { getMap, getControl } = parentContext;
let layerGroup;
let ready = false;
onMount(() => {
  layerGroup = new LayerGroup([], options);
  ready = true;
});
$: map = getMap?.();
$: controlLayers = getControl?.();
$: instance = layerGroup;
$: if (map) {
  if (layerGroup) {
    if (controlLayers) {
      if (!name) {
        console.warn("Name is required in ControlLayers");
      } else {
        setControlLayer({
          layer: layerGroup,
          name,
          controlLayers,
          layerType,
          map,
          checked
        });
      }
      controlLayers.addTo(map);
    } else {
      map.addLayer(layerGroup);
    }
  }
}
function reset() {
  layerGroup?.remove();
  layerGroup = void 0;
}
onDestroy(() => {
  reset();
});
setContext(Map, { ...parentContext, getLayer: () => layerGroup });
</script>

{#if ready}
	<slot />
{/if}
