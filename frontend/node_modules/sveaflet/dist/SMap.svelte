<script>import { onMount, onDestroy, setContext } from "svelte";
import { Map, Icon } from "leaflet";
import "leaflet/dist/leaflet.css";
import markerIcon2x from "leaflet/dist/images/marker-icon-2x.png";
import markerIcon from "leaflet/dist/images/marker-icon.png";
import markerShadow from "leaflet/dist/images/marker-shadow.png";
import { Compare } from "./utils/index";
delete Icon.Default.prototype._getIconUrl;
Icon.Default.mergeOptions({
  iconRetinaUrl: markerIcon2x,
  iconUrl: markerIcon,
  shadowUrl: markerShadow
});
export let options = {};
export let instance = void 0;
let map;
let mapContainer;
let compare;
$: instance = map;
onMount(() => {
  map = new Map(mapContainer, options);
  compare = new Compare(map, $$props);
});
$: if (map) {
  compare.updateProps($$props);
  compare.storeProps($$props);
}
function reset() {
  map?.remove();
  map = void 0;
}
onDestroy(() => {
  reset();
});
setContext(Map, { getMap: () => map });
</script>

<div style="width:100%;height:100%" bind:this={mapContainer}>
	{#if map}
		<slot />
	{/if}
</div>
