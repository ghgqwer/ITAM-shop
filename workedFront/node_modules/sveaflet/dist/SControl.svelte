<script>import { onMount, onDestroy, getContext } from "svelte";
import { Map, Control } from "leaflet";
import { Compare } from "./utils/index";
export let options = { position: "topright" };
export let instance = void 0;
let parentContext = getContext(Map);
const { getMap } = parentContext;
let control;
let htmlElement;
let ready = false;
let compare;
$: map = getMap?.();
$: instance = control;
onMount(() => {
  let CustomControl;
  CustomControl = Control.extend({
    onAdd() {
      return htmlElement;
    }
  });
  control = new CustomControl(options);
  compare = new Compare(control, $$props);
  ready = true;
});
$: if (map) {
  if (control) {
    compare.updateProps($$props);
    map.addControl(control);
    compare.storeProps($$props);
  }
}
function reset() {
  control?.remove();
  control = void 0;
}
onDestroy(() => {
  reset();
});
</script>

<div bind:this={htmlElement} {...$$restProps} class={`leaflet-control ${$$restProps.class ?? ''}`}>
	{#if ready}
		<slot />
	{/if}
</div>
